---
title: "project3"
author: "Sibei Liu sl4660"
date: "2020/4/14"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,message=FALSE,warning=TRUE)
library(tidyverse)
```

data cleaning
```{r}
data_all=read_csv("covid19-1.csv") 
names(data_all)=c("id","province","region","lat","long","date","confirm","fatality") 

# incorporate privince data
clean_data=data_all %>% filter(confirm>0) %>% select(-lat,-long) %>% group_by(region,date) %>%summarise(case=sum(confirm)) 

g=split(clean_data,clean_data$region)
i=i
for(i  in 1:length(g)){
  h=NULL
  d=1
for(d in 1:nrow(g[[i]]))
{h[d]=as.numeric(as.Date(strptime( "1/1/20", "%m/%d/%y"))-as.Date(strptime(g[[i]][d,2], "%m/%d/%y")))
d=d+1}
initial=(g[[i]][which(h==max(h)),2])

g[[i]]=g[[i]]%>% mutate(
  t_diff=as.numeric(as.Date(strptime(date, "%m/%d/%y"))-as.Date(strptime(initial, "%m/%d/%y")))) %>% 
  mutate(cul=cumsum(case))
i=i+1
}

update=NULL
for( c in 1:length(g))
update=rbind(update,g[[c]])

## update is the cleaned data

trial_data=update %>% filter(region=="Afghanistan")
```

### useless code below
```{r}

data_trans=function(x,y,a,c){
  x=x-c
  y=y/a
  return(list(x=x,y=y))
}

loss_grain=function(k,x,y){
  loss=-(1/n)sum(y*x*k-log(1+exp(k*x)))
  gradient=-(1/n)sum(y*x+exp(k*x)/(1+exp(k*x)))
  return(list(loss=loss,gradient=gradient))
}

```

